{"version":3,"sources":["webpack:///./src/routes/setup-2fa.vue?e099","webpack:///src/routes/setup-2fa.vue","webpack:///./src/routes/setup-2fa.vue?8a4d","webpack:///./src/routes/setup-2fa.vue","webpack:///./src/routes/setup-2fa.vue?c812","webpack:///./src/routes/setup-2fa.vue?8730"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","$t","finished","fetchingData","_e","_v","tfa_secret","staticClass","totpUrl","width","on","save2faSecret","enterApp","saving","slot","_s","error","staticRenderFns","component"],"mappings":"kHAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,aAAa,CAACE,MAAM,CAAC,QAAUN,EAAIO,GAAG,eAAe,EAAmB,IAAjBP,EAAIQ,UAAuBR,EAAIS,aAA8TT,EAAIU,KAApT,CAACN,EAAG,IAAI,CAACJ,EAAIW,GAAG,sHAAwHX,EAAIY,WAA4BR,EAAG,UAAU,CAACS,YAAY,KAAKP,MAAM,CAAC,MAAQN,EAAIc,QAAQ,QAAU,CAAEC,MAAO,QAA7FX,EAAG,aAAmGA,EAAG,YAAY,CAACY,GAAG,CAAC,MAAQhB,EAAIiB,mBAA6C,IAAjBjB,EAAIQ,UAAsBR,EAAIS,aAAgNT,EAAIU,KAAtM,CAACN,EAAG,IAAI,CAACJ,EAAIW,GAAG,2FAA2FP,EAAG,SAAS,CAACE,MAAM,CAAC,KAAO,UAAUU,GAAG,CAAC,MAAQhB,EAAIkB,WAAW,CAAClB,EAAIW,GAAG,eAAyBX,EAAImB,QAAUnB,EAAIS,aAAcL,EAAG,oBAAoB,CAACS,YAAY,UAAUP,MAAM,CAAC,cAAgB,GAAG,QAAU,MAAMN,EAAIU,KAAMV,EAAS,MAAEI,EAAG,gBAAgB,CAACE,MAAM,CAAC,KAAO,SAAS,MAAQ,UAAUc,KAAK,UAAU,CAACpB,EAAIW,GAAG,IAAIX,EAAIqB,GAAGrB,EAAIO,GAAI,UAAaP,EAAIsB,MAAU,OAAK,OAAOtB,EAAIU,MAAM,IAC1hCa,EAAkB,G,6ICkCtB,GACA,gBACA,YACA,kBACA,oBACA,WACA,iBAEA,KARA,WASA,OACA,gBACA,WACA,YACA,UACA,kBAGA,0CACA,qDADA,IAEA,QAFA,WAGA,sIAGA,QAvBA,WAwBA,uBAEA,SACA,eADA,WACA,8KACA,oCADA,OACA,EADA,OAEA,kCAFA,8CAIA,cALA,SAKA,0KACA,YADA,sBAGA,2BAHA,uBAIA,GAFA,EAFA,oBAQA,4CARA,OASA,cATA,mDAWA,aACA,oBAZA,yBAcA,YAdA,+EAiBA,SAtBA,WAsBA,qKACA,kBADA,SAIA,iBAJA,OAOA,EAPA,WAOA,oBAPA,gBAUA,uCACA,wCAIA,0BACA,2BAGA,6BAGA,qBAtBA,gDCnFmV,I,kCCS/UC,EAAY,eACd,EACAzB,EACAwB,GACA,EACA,KACA,WACA,MAIa,aAAAC,E,6FCpBf,yBAAsiB,EAAG,G,kCCAziB,yBAA8gB,EAAG","file":"js/setup-2fa.379c0dc3.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('PublicView',{attrs:{\"heading\":_vm.$t('setup_2fa')}},[(_vm.finished === false && !_vm.fetchingData)?[_c('p',[_vm._v(\" Scan this QR code with your authenticator app, then enter the verification code it provides to complete setup. \")]),(!_vm.tfa_secret)?_c('v-spinner'):_c('qr-code',{staticClass:\"qr\",attrs:{\"value\":_vm.totpUrl,\"options\":{ width: 340 }}}),_c('otp-input',{on:{\"input\":_vm.save2faSecret}})]:_vm._e(),(_vm.finished === true && !_vm.fetchingData)?[_c('p',[_vm._v(\" Congratulations! You have successfully set up 2-factor authentication for Directus. \")]),_c('button',{attrs:{\"type\":\"button\"},on:{\"click\":_vm.enterApp}},[_vm._v(\"Continue\")])]:_vm._e(),(_vm.saving || _vm.fetchingData)?_c('v-progress-linear',{staticClass:\"loading\",attrs:{\"indeterminate\":\"\",\"rounded\":\"\"}}):_vm._e(),(_vm.error)?_c('public-notice',{attrs:{\"slot\":\"notice\",\"color\":\"danger\"},slot:\"notice\"},[_vm._v(\" \"+_vm._s(_vm.$t((\"errors.\" + (_vm.error.code))))+\" \")]):_vm._e()],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n\t<PublicView :heading=\"$t('setup_2fa')\">\r\n\t\t<template v-if=\"finished === false && !fetchingData\">\r\n\t\t\t<!-- <h2 class=\"type-title\">Scan the QR Code</h2> -->\r\n\t\t\t<p>\r\n\t\t\t\tScan this QR code with your authenticator app, then enter the verification code it\r\n\t\t\t\tprovides to complete setup.\r\n\t\t\t</p>\r\n\t\t\t<v-spinner v-if=\"!tfa_secret\" />\r\n\t\t\t<qr-code v-else class=\"qr\" :value=\"totpUrl\" :options=\"{ width: 340 }\" />\r\n\t\t\t<otp-input @input=\"save2faSecret\" />\r\n\t\t</template>\r\n\t\t<template v-if=\"finished === true && !fetchingData\">\r\n\t\t\t<p>\r\n\t\t\t\tCongratulations! You have successfully set up 2-factor authentication for Directus.\r\n\t\t\t</p>\r\n\t\t\t<button type=\"button\" @click=\"enterApp\">Continue</button>\r\n\t\t</template>\r\n\t\t<v-progress-linear v-if=\"saving || fetchingData\" class=\"loading\" indeterminate rounded />\r\n\t\t<public-notice v-if=\"error\" slot=\"notice\" color=\"danger\">\r\n\t\t\t{{ $t(`errors.${error.code}`) }}\r\n\t\t</public-notice>\r\n\t</PublicView>\r\n</template>\r\n\r\n<script>\r\nimport PublicView from '@/components/public-view';\r\nimport PublicNotice from '@/components/public/notice';\r\nimport QrCode from '@chenfengyuan/vue-qrcode';\r\nimport { mapState } from 'vuex';\r\nimport OtpInput from '@/components/public/otp-input';\r\nimport hydrateStore from '@/hydrate';\r\n\r\n// NOTE: We'll have to use tfa instead of 2fa in JavaScript. Variables can't start with a number\r\n\r\nexport default {\r\n\tname: 'Setup2FA',\r\n\tcomponents: {\r\n\t\tPublicView,\r\n\t\tPublicNotice,\r\n\t\tQrCode,\r\n\t\tOtpInput\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\ttfa_secret: null,\r\n\t\t\terror: null,\r\n\t\t\tfinished: false,\r\n\t\t\tsaving: false,\r\n\t\t\tfetchingData: false\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapState(['apiRootPath', 'currentProjectKey']),\r\n\t\ttotpUrl() {\r\n\t\t\treturn `otpauth://totp/Directus:${this.$store.state.currentUser.email}?secret=${this.tfa_secret}&issuer=Directus`;\r\n\t\t}\r\n\t},\r\n\tcreated() {\r\n\t\tthis.fetch2faSecret();\r\n\t},\r\n\tmethods: {\r\n\t\tasync fetch2faSecret() {\r\n\t\t\tconst response = await this.$api.api.get('/utils/2fa_secret');\r\n\t\t\tthis.tfa_secret = response.data['2fa_secret'];\r\n\t\t},\r\n\t\tasync save2faSecret(otp) {\r\n\t\t\tthis.saving = true;\r\n\t\t\tconst body = {\r\n\t\t\t\t['2fa_secret']: this.tfa_secret,\r\n\t\t\t\totp: otp\r\n\t\t\t};\r\n\r\n\t\t\ttry {\r\n\t\t\t\tawait this.$api.api.post('/users/me/activate_2fa', body);\r\n\t\t\t\tthis.finished = true;\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthis.error = error;\r\n\t\t\t\tconsole.error(error);\r\n\t\t\t} finally {\r\n\t\t\t\tthis.saving = false;\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync enterApp() {\r\n\t\t\tthis.fetchingData = true;\r\n\r\n\t\t\t// This will fetch all the needed information about the project in order to run Directus\r\n\t\t\tawait hydrateStore();\r\n\r\n\t\t\t// Default to /collections as homepage\r\n\t\t\tlet route = `/${this.currentProjectKey}/collections`;\r\n\r\n\t\t\t// If the last visited page is saved in the current user record, use that\r\n\t\t\tif (this.$store.state.currentUser.last_page) {\r\n\t\t\t\troute = this.$store.state.currentUser.last_page;\r\n\t\t\t}\r\n\r\n\t\t\t// In the case the URL contains a redirect query, use that instead\r\n\t\t\tif (this.$route.query.redirect) {\r\n\t\t\t\troute = this.$route.query.redirect;\r\n\t\t\t}\r\n\r\n\t\t\tthis.$router.push(route, () => {\r\n\t\t\t\t// We only set the fetchingData flag to false when the page navigation is done\r\n\t\t\t\t// This makes sure we don't show a flash of \"authenticated\" style login view\r\n\t\t\t\tthis.fetchingData = false;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.qr {\r\n\tmargin-bottom: 32px;\r\n\tborder: var(--input-border-width) solid var(--input-border-color);\r\n\tborder-radius: var(--border-radius);\r\n}\r\n</style>\r\n\r\n<style lang=\"scss\" scoped>\r\np {\r\n\tfont-size: 16px;\r\n\tline-height: 26px;\r\n\tmargin-top: 32px;\r\n\tmargin-bottom: 32px;\r\n\tcolor: var(--blue-grey-300);\r\n}\r\n\r\n.loading {\r\n\tmargin-top: 32px;\r\n\tmargin-bottom: 32px;\r\n}\r\n\r\n.button,\r\nbutton {\r\n\tposition: relative;\r\n\tbackground-color: var(--button-primary-background-color);\r\n\tborder: 2px solid var(--button-primary-background-color);\r\n\tborder-radius: var(--border-radius);\r\n\tcolor: var(--button-primary-text-color);\r\n\theight: 60px;\r\n\tpadding: 18px 20px;\r\n\twidth: 100%;\r\n\tmax-width: 154px;\r\n\tfont-size: 16px;\r\n\tfont-weight: 400;\r\n\ttransition: background-color var(--fast) var(--transition);\r\n\tdisplay: inline-block;\r\n\ttext-decoration: none;\r\n\ttext-align: center;\r\n\r\n\t&[disabled] {\r\n\t\tcursor: not-allowed;\r\n\t}\r\n\r\n\t&:not([disabled]) {\r\n\t\t&:hover {\r\n\t\t\tbackground-color: var(--darkest-gray);\r\n\t\t\tborder-color: var(--darkest-gray);\r\n\t\t}\r\n\t}\r\n\r\n\t&.outline {\r\n\t\tbackground-color: transparent;\r\n\t\tcolor: var(--darkest-gray);\r\n\r\n\t\t&[disabled] {\r\n\t\t\tbackground-color: transparent;\r\n\t\t}\r\n\r\n\t\t&:not([disabled]) {\r\n\t\t\t&:hover {\r\n\t\t\t\tbackground-color: transparent;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./setup-2fa.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./setup-2fa.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./setup-2fa.vue?vue&type=template&id=f523e0da&scoped=true&\"\nimport script from \"./setup-2fa.vue?vue&type=script&lang=js&\"\nexport * from \"./setup-2fa.vue?vue&type=script&lang=js&\"\nimport style0 from \"./setup-2fa.vue?vue&type=style&index=0&lang=scss&\"\nimport style1 from \"./setup-2fa.vue?vue&type=style&index=1&id=f523e0da&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f523e0da\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./setup-2fa.vue?vue&type=style&index=1&id=f523e0da&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./setup-2fa.vue?vue&type=style&index=1&id=f523e0da&lang=scss&scoped=true&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./setup-2fa.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./setup-2fa.vue?vue&type=style&index=0&lang=scss&\""],"sourceRoot":""}